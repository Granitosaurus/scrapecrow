<!DOCTYPE html>
<html lang="en">

<head>
  <title> Scrapecrow - Tracking Website Changes: Crypto News Notifications</title>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="description" content="Educational blog about web-scraping, crawling and related data extraction subjects" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css"
    integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
  <script src="https://scrapecrow.com/theme/main.js"></script>
  <link rel="stylesheet" href="https://scrapecrow.com/theme/css/main.css" />
  <link rel="stylesheet" href="https://scrapecrow.com/theme/css/applause-button.css" />
  <script src="https://scrapecrow.com/theme/applause-button.js"></script>
  <link href="Scrapecrow/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
    title="Scrapecrow Full Atom Feed" />
  <link href="Scrapecrow/atom.xml" type="application/atom+xml" rel="alternate"
    title="Scrapecrow Atom Feed" />
  <link href="Scrapecrow/rss.xml" type="application/rss+xml" rel="alternate"
    title="Scrapecrow RSS Feed" />
  <link href="Scrapecrow/feeds/{slug}.atom.xml" type="application/atom+xml"
    rel="alternate" title="Scrapecrow Categories Atom Feed" />

<meta name="author" content="Bernardas Ališauskas" />
<meta name="description" content="TODO" />
  <meta property="og:site_name" content="Scrapecrow"/>
  <meta property="og:title" content="Tracking Website Changes: Crypto News Notifications"/>
  <meta property="og:description" content="TODO"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://scrapecrow.com/drafts/tracking-website-changes.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-11-01 00:00:00+01:00"/>
  <meta property="article:modified_time" content="2021-11-01 00:00:00+01:00"/>
  <meta property="article:author" content="Bernardas Ališauskas">
  <meta property="article:section" content="articles"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="beginner"/>
  <meta property="article:tag" content="tracking"/>
  <meta property="og:image" content="https://scrapecrow.com/images/logo-og.png">
</head>

<body>
  <div class="navigation">
    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://scrapecrow.com">
          <img src="/images/logo.svg" width="50"></img>
        </a>
        <a class="navbar-item" href="https://scrapecrow.com">Scrapecrow</a>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-start">
          <a class="navbar-item" href="/pages/about.html">about</a>
          <a class="navbar-item" href="/pages/coffee.html">☕</a>
          <a class="navbar-item" href="https://matrix.to/#/#web-scraping:matrix.org">#web-scraping on matrix</a>
        </div>
      </div>
    </nav>
  </div>
  <div class="main">
<div class="content">
  <div class="post-meta">
<div class="post-meta">
    <a href="https://scrapecrow.com/category/articles.html" class="category">articles</a>
    &mdash;
    <span title="2021-11-01T00:00:00+01:00">Mon 01 November 2021</span></br>
    <a class="tag" href="https://scrapecrow.com/tag/python.html" title="python programming language">python</a>
    <a class="tag" href="https://scrapecrow.com/tag/beginner.html" title="beginner level article">beginner</a>
    <a class="tag" href="https://scrapecrow.com/tag/tracking.html" title="">tracking</a>
    </br>
</div>  </div>
  <h1>Tracking Website Changes: Crypto News Notifications</h1>
  <div class="post-content">
    <!--insert table of contents between text and first header-->
    <p>Tracking scrapers are one of the most commonly encountered scrapers. The goal of tracking scrapers is to track changes on websites and perform some sort of callback like a notification, email or just a historic data entry.</p>
<p>In this article we'll take a look how to efficiently develop a tracking scraper that takes advantage of caching and proxies to scrape crypto news articles as soon as they are released.</p>

    <hr>
    <div class="pure-u">
      <div id="toc"><ul><li><a class="toc-href" href="#taking-advantage-of-client-side-caching" title="Taking Advantage of Client-Side Caching">Taking Advantage of Client-Side Caching</a><ul><li><a class="toc-href" href="#last-modified-header" title="Last Modified Header">Last Modified Header</a></li><li><a class="toc-href" href="#etag-header" title="Etag Header">Etag Header</a></li></ul></li><li><a class="toc-href" href="#summary-and-further-reading_1" title="Summary and Further Reading">Summary and Further Reading</a></li></ul></div>
    </div>
    <hr>
    <h2 id="taking-advantage-of-client-side-caching">Taking Advantage of Client-Side Caching</h2>
<p>Tracking website changes can be bandwidth expensive - if we download 1mb website every second we end up burning 60mb/minute which is 86mb every 24 hours! <br/>
Not only that, but we put unnecessary pressure to target websites which might lead to banning or blocking.</p>
<p>Fortunately, modern web offers client side caching indicators. We can reduce our load by checking whether content changes and only then download the full body. </p>
<p>We can accomplish this by sending <code>HEAD</code> type requests which return only response headers (without the body). We then can analyze response headers to determine whether we want to request the response body.  </p>
<p>There are few ways for a server to indicate content version, so let's take a quick look at them.</p>
<h3 id="last-modified-header">Last Modified Header</h3>
<p>This header is often used by dynamic articles such as wikipedia to indicate when the source was last modified:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>"Last-Modified": "Tue, 16 Nov 2021 11:04:59 GMT"
</code></pre></div></td></tr></table></div>
<p>Using this header we can reduce our resource load significantly by looping <code>HEAD</code> requests until change detected. 
Let's take this wikipedia page for example <a href="https://en.wikipedia.org/wiki/Web_scraping">https://en.wikipedia.org/wiki/Web_scraping</a> for which we'd like to write a notification scraper that detect changes as soon as possible:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">last_modified</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">"https://en.wikipedia.org/wiki/Web_scraping"</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">resp_head</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resp_head</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Last-Modified'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">last_modified</span><span class="p">:</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">resp_head</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Last-Modified'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"change detected!"</span><span class="p">)</span>
        <span class="c1"># additionally we can full response for better notification details</span>
        <span class="n">resp_full</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp_full</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this tiny notification script we establish a requests session and every second we make a <code>HEAD</code> request to our target. If the response headers' contain a new <code>Last-Modified</code> value we call our notification, otherwise we continue checking until it does!</p>
<h3 id="etag-header">Etag Header</h3>
<p>One alternative to <code>Last-Modified</code> header is the <code>Etag</code> header which just like the former indicates a soft version of the page. Just instead of a datetime string, Etag header uses a short hash.</p>
<p>Let's take a look at <code>Etag</code> header in a common example: sports match tracking.
Imagine we're following a football game and we'd like to know scores as soon as they change. Again, we can apply similar logic we used in <code>Last-Modified</code> scraper above:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">last_etag</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">"https://onefootball.com/en/match/2263090"</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">resp_head</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resp_head</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Etag"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">last_etag</span><span class="p">:</span>
        <span class="n">last_etag</span> <span class="o">=</span> <span class="n">resp_head</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Etag"</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"change detected!"</span><span class="p">)</span>
        <span class="c1"># additionally we can full response for better notification details</span>
        <span class="n">resp_full</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">extract_scores_from_response</span><span class="p">(</span><span class="n">resp_full</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this script we keep sending <code>HEAD</code> requests until a new <code>Etag</code> header is encountered - then we can scrape HTML body for match updates and send them to our notification server (email, notification, SMS)</p>
<h2 id="summary-and-further-reading_1">Summary and Further Reading</h2>
  </div>
</div>
<hr>
<div class="article-buttons">
  <div class="float-side applause" title="show your appreciation">
    <applause-button url="https://scrapecrow.com/drafts/tracking-website-changes.html" style="width: 58px; height: 58px;" />
  </div>
  <div class="article-button applause" title="show your appreciation">
    <applause-button url="https://scrapecrow.com/drafts/tracking-website-changes.html" style="width: 58px; height: 58px;" />
  </div>
  <div class="article-button twitter" title="share on twitter">
    <a href="http://twitter.com/share?text=&url=https://scrapecrow.com/drafts/tracking-website-changes.html&hashtags=">
      <i class="fa fa-twitter fa-3x pure-menu-link" aria-hidden="true"></i>
    </a>
  </div>
  <div class="article-button email">
    <a href="https://716df175.sibforms.com/serve/MUIEALpKPp8WjHrVwQOX6keZXLkJRbnFEh2y6YhTmVmT4Z0Khgbi2MFvPO1OObOrjbMi_S0M7VXkXGkcbh36H-SqEwM3dHXxdrOOXwEPGcp9rTQKkQvMkC70Dq9RmCoikia87nLsRcx0VVGmCG2zyx5s8BwpqevRmh70vKSaLe7e95yZDCROMvm2HcN3UpLw7UsFxl_UbI6TjY_e" title="subscribe to mailist">
      <i class="fa fa-email-bulk-o fa-3x pure-menu-link" aria-hidden="true"></i>
    </a>
  </div>
</div>
<hr>
<div class="comments">
  <script src="https://utteranc.es/client.js" repo="granitosaurus/scrapecrow"
    issue-term="tracking-website-changes" label="comments"
    theme="github-light" crossorigin="anonymous" async>
  </script>
</div>
  </div>
  <footer class="footer">
    <div class="content">
      <span class="footer-item"><a href="/archives.html">Archives</a></span>
      <span class="footer-item"><a href="/tags.html">Tags</a></span>
      <span class="footer-item"><a href="https://blog.getpelican.com/">Made with Pelican</a></span>
      <span class="footer-item"><a href="https://github.com/granitosaurus/scrapecrow/">Source on Github</a></span>
      <span class="footer-item"><a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a></span>
      <span class="footer-item">
        <a href="atom.xml">
          <i class="fa fa-rss-square" aria-hidden="true"></i>
        </a>
      </span>
    </div>
  </footer>
<script data-goatcounter="https://scrapecrow.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>

</html>